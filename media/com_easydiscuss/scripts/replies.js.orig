EasyDiscuss.module("replies",function(e){var t=this;EasyDiscuss.require().view("comment.form").script("comments").language("COM_EASYDISCUSS_REPLY_LOADING_MORE_COMMENTS","COM_EASYDISCUSS_REPLY_LOAD_ERROR").done(function(){EasyDiscuss.Controller("Replies",{defaultOptions:{termsCondition:null,sort:null,"{replyItem}":".discussReplyItem"}},function(t){return{init:function(){t.initItem(t.replyItem())},initItem:function(e){e.implement(EasyDiscuss.Controller.Reply.Item,{controller:{parent:t},termsCondition:t.options.termsCondition})},addItem:function(n){var r=e(n);t.options.sort=="latest"?r.prependTo(t.element):e(".replyLoadMore").length==0?r.appendTo(t.element):e(".replyLoadMore").controller().loadedAllReplies&&r.appendTo(t.element),t.initItem(r)},replaceItem:function(n,r){var i=e(r);t.replyItem("[data-id="+n+"]").replaceWith(i),t.initItem(i)}}}),EasyDiscuss.Controller("Reply.Item",{defaultOptions:{id:null,termsCondition:null,view:{commentForm:"comment.form"},"{addCommentButton}":".addComment","{commentFormContainer}":".commentFormContainer","{commentNotification}":".commentNotification","{commentsList}":".commentsList","{commentLoadMore}":".commentLoadMore","{editReplyButton}":".editReplyButton","{cancelReplyButton}":".cancel-reply","{composerContainer}":".discuss-composer-container","{composer}":".discuss-composer","{alertMessage}":".alertMessage"}},function(t){return{init:function(){t.options.id=t.element.data("id"),t.commentsList().implement(EasyDiscuss.Controller.Comment.List),t.commentLoadMore().length>0&&t.commentLoadMore().implement(EasyDiscuss.Controller.Comment.LoadMore,{controller:{list:t.commentsList().controller()}})},"{editReplyButton} click":function(){t.edit()},alert:function(n,r,i){r===undefined&&(r="info"),t.removeAlert(),e('<div class="alert alertMessage"></div>').addClass("alert-"+r).html(n).prependTo(t.composerContainer()),i&&setTimeout(function(){t.alertMessage().fadeOut("slow",function(){t.removeAlert()})},i)},removeAlert:function(){t.alertMessage().remove()},edit:function(){t.editReplyButton().addClass("btn-loading"),EasyDiscuss.ajax("site.views.post.editReply",{id:t.options.id}).done(function(e,n){t.composer().remove(),t.composerContainer().append(n),discuss.composer.init("."+e)}).fail(function(){t.alert("Unable to load composer.","error",3e3)}).always(function(){t.editReplyButton().removeClass("btn-loading")})},"{composer} save":function(n,r,i){var s=e(i).filter(".discussReplyItem");if(s.length>0){t.composer().remove(),t.parent.replaceItem(t.options.id,s);var o=s.find(".postLocation");if(o.length>0){var u=e.parseJSON(o.find(".locationData").val());EasyDiscuss.require().script("location").done(function(e){o.implement("EasyDiscuss.Controller.Location.Map",u)})}}},"{composer} cancel":function(){t.composer().remove()},"{addCommentButton} click":function(){var n=t.view.commentForm({id:t.options.id});e(n).implement(EasyDiscuss.Controller.Comment.Form,{container:t.commentFormContainer(),notification:t.commentNotification(),commentsList:t.commentsList(),loadMore:t.commentLoadMore(),termsCondition:t.options.termsCondition}),t.commentFormContainer().html(n).toggle()}}}),EasyDiscuss.Controller("Replies.LoadMore",{defaultOptions:{id:null,sort:null}},function(t){return{init:function(){t.loadedAllReplies=!1},"{self} click":function(n){n.enabled()&&(n.disabled(!0),n.addClass("btn-loading").html(e.language("COM_EASYDISCUSS_REPLY_LOADING_MORE_COMMENTS")),EasyDiscuss.ajax("site.views.post.getReplies",{id:t.options.id,start:t.list.replyItem().length,sort:t.options.sort}).done(function(r,i){var s=e(r).filter("li");s.implement(EasyDiscuss.Controller.Reply.Item,{controller:{parent:t.list},termsCondition:t.list.options.termsCondition}),t.list.element.append(s),i?n.enabled(!0):(n.hide(),t.loadedAllReplies=!0)}).fail(function(){n.addClass("btn-danger").html(e.language("COM_EASYDISCUSS_REPLY_LOAD_ERROR"))}).always(function(){n.removeClass("btn-loading")}))}}}),t.resolve()})});